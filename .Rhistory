geom_jitter(width = 0.1) +
scale_y_continuous(label = scales::percent) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance")
p4
p4 <- ggplot(bs, aes(x = new, y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_continuous(label = scales::percent) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Most abundant genera")
p4
df
kable(dfm)
p4
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(temp.phy, "Genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
x <- prevalence(b.core)
bs <- melt(abundances(b.core))
#bs$new <- bs$Var1
#bs$new <- gsub(bs$new, pattern = "Propionibacterium", replacement = "Cutibacterium")
#names(x) <- gsub(names(x), pattern = "Propionibacterium", replacement = "Cutibacterium")
df <- data.frame(Genus = names(x), prevalence = x) %>% arrange(prevalence)
sorted.names <- df$Genus
df$Genus <- factor(df$Genus, levels = sorted.names)
bs$new <- factor(bs$new, levels=sorted.names)
p4 <- ggplot(bs, aes(x = new, y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_continuous(label = scales::percent) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Most prevalent genera")
#bs$new <- factor(bs$new, levels=sorted.names)
p4 <- ggplot(bs, aes(x = new, y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_continuous(label = scales::percent) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Most prevalent genera")
p4
#bs$new <- factor(bs$new, levels=sorted.names)
p4 <- ggplot(bs, aes(x = new, y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_continuous(label = scales::percent) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Most prevalent genera")
p4
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(temp.phy, "Genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
x <- prevalence(b.core)
bs <- melt(abundances(b.core))
#bs$new <- bs$Var1
#bs$new <- gsub(bs$new, pattern = "Propionibacterium", replacement = "Cutibacterium")
#names(x) <- gsub(names(x), pattern = "Propionibacterium", replacement = "Cutibacterium")
df <- data.frame(Genus = names(x), prevalence = x) %>% arrange(prevalence)
#sorted.names <- df$Genus
df$Genus <- factor(df$Genus, levels = sorted.names)
#bs$new <- factor(bs$new, levels=sorted.names)
p4 <- ggplot(bs, aes(x = new, y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_continuous(label = scales::percent) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Most prevalent genera")
print(p4)
bs
#bs$new <- factor(bs$new, levels=sorted.names)
p4 <- ggplot(bs, aes(x = Var1, y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_continuous(label = scales::percent) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Most prevalent genera")
p4
#theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(temp.phy, "Genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
x <- prevalence(b.core)
bs <- melt(abundances(b.core))
#bs$new <- bs$Var1
#bs$new <- gsub(bs$new, pattern = "Propionibacterium", replacement = "Cutibacterium")
#names(x) <- gsub(names(x), pattern = "Propionibacterium", replacement = "Cutibacterium")
df <- data.frame(Genus = names(x), prevalence = x) %>% arrange(prevalence)
#sorted.names <- df$Genus
df$Genus <- factor(df$Genus, levels = sorted.names)
#bs$new <- factor(bs$new, levels=sorted.names)
p4 <- ggplot(bs, aes(x = Var1, y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_continuous(label = scales::percent) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Most prevalent genera")
#theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(temp.phy, "Genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
x <- prevalence(b.core)
bs <- melt(abundances(b.core))
#bs$new <- bs$Var1
#bs$new <- gsub(bs$new, pattern = "Propionibacterium", replacement = "Cutibacterium")
#names(x) <- gsub(names(x), pattern = "Propionibacterium", replacement = "Cutibacterium")
df <- data.frame(Genus = names(x), prevalence = x) %>% arrange(prevalence)
#sorted.names <- df$Genus
df$Genus <- factor(df$Genus, levels = sorted.names)
#bs$new <- factor(bs$new, levels=sorted.names)
p4 <- ggplot(bs, aes(x = Var1, y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_continuous(label = scales::percent) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Most prevalent genera")
print(p4)
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(temp.phy, "Genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
x <- prevalence(b.core)
bs <- melt(abundances(b.core))
#bs$new <- bs$Var1
#bs$new <- gsub(bs$new, pattern = "Propionibacterium", replacement = "Cutibacterium")
#names(x) <- gsub(names(x), pattern = "Propionibacterium", replacement = "Cutibacterium")
df <- data.frame(Genus = names(x), prevalence = x) %>% arrange(prevalence)
#sorted.names <- df$Genus
df$Genus <- factor(df$Genus, levels = sorted.names)
#bs$new <- factor(bs$new, levels=sorted.names)
p4 <- ggplot(bs, aes(x = Var1, y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_continuous(label = scales::percent) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Most prevalent genera")
print(p4)
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(temp.phy, "Genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
x <- prevalence(b.core)
bs <- melt(abundances(b.core))
#bs$new <- bs$Var1
#bs$new <- gsub(bs$new, pattern = "Propionibacterium", replacement = "Cutibacterium")
#names(x) <- gsub(names(x), pattern = "Propionibacterium", replacement = "Cutibacterium")
df <- data.frame(Genus = names(x), prevalence = x) %>% arrange(prevalence)
#sorted.names <- df$Genus
df$Genus <- factor(df$Genus, levels = sorted.names)
#bs$new <- factor(bs$new, levels=sorted.names)
p4 <- ggplot(bs, aes(x = Var1, y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_continuous(label = scales::percent) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Most prevalent genera")
print(p4)
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(temp.phy, "Genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
x <- prevalence(b.core)
bs <- melt(abundances(b.core))
#bs$new <- bs$Var1
#bs$new <- gsub(bs$new, pattern = "Propionibacterium", replacement = "Cutibacterium")
#names(x) <- gsub(names(x), pattern = "Propionibacterium", replacement = "Cutibacterium")
df <- data.frame(Genus = names(x), prevalence = x) %>% arrange(prevalence)
#sorted.names <- df$Genus
df$Genus <- factor(df$Genus, levels = sorted.names)
#bs$new <- factor(bs$new, levels=sorted.names)
p4 <- ggplot(bs, aes(x = Var1, y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_continuous(label = scales::percent) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Most prevalent genera")
print(p4)
#bs$new <- bs$Var1
#bs$new <- gsub(bs$new, pattern = "Propionibacterium", replacement = "Cutibacterium")
#names(x) <- gsub(names(x), pattern = "Propionibacterium", replacement = "Cutibacterium")
df <- data.frame(Genus = names(x), prevalence = x) %>% arrange(prevalence)
df
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(temp.phy, "Genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
x <- prevalence(b.core)
bs <- melt(abundances(b.core))
#bs$new <- bs$Var1
#bs$new <- gsub(bs$new, pattern = "Propionibacterium", replacement = "Cutibacterium")
#names(x) <- gsub(names(x), pattern = "Propionibacterium", replacement = "Cutibacterium")
df <- data.frame(Genus = names(x), prevalence = x) %>% arrange(prevalence)
#sorted.names <- df$Genus
df$Genus <- factor(df$Genus, levels = sorted.names)
#bs$new <- factor(bs$new, levels=sorted.names)
p4 <- ggplot(df, aes(x = Genus, y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_continuous(label = scales::percent) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Most prevalent genera")
print(p4)
df
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(temp.phy, "Genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
x <- prevalence(b.core)
bs <- melt(abundances(b.core))
#bs$new <- bs$Var1
#bs$new <- gsub(bs$new, pattern = "Propionibacterium", replacement = "Cutibacterium")
#names(x) <- gsub(names(x), pattern = "Propionibacterium", replacement = "Cutibacterium")
df <- data.frame(Genus = names(x), prevalence = x) %>% arrange(prevalence)
#sorted.names <- df$Genus
df$Genus <- factor(df$Genus, levels = sorted.names)
#bs$new <- factor(bs$new, levels=sorted.names)
p4 <- ggplot(df, aes(x = Genus, y = prevalence)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_continuous(label = scales::percent) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Most prevalent genera")
print(p4)
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(temp.phy, "Genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
x <- prevalence(b.core)
bs <- melt(abundances(b.core))
#bs$new <- bs$Var1
#bs$new <- gsub(bs$new, pattern = "Propionibacterium", replacement = "Cutibacterium")
#names(x) <- gsub(names(x), pattern = "Propionibacterium", replacement = "Cutibacterium")
df <- data.frame(Genus = names(x), prevalence = x) %>% arrange(prevalence)
sorted.names <- df$Genus
df$Genus <- factor(df$Genus, levels = sorted.names)
#bs$new <- factor(bs$new, levels=sorted.names)
p4 <- ggplot(df, aes(x = Genus, y = prevalence)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_continuous(label = scales::percent) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Most prevalent genera")
print(p4)
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(temp.phy, "Genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
x <- prevalence(b.core)
bs <- melt(abundances(b.core))
#bs$new <- bs$Var1
#bs$new <- gsub(bs$new, pattern = "Propionibacterium", replacement = "Cutibacterium")
#names(x) <- gsub(names(x), pattern = "Propionibacterium", replacement = "Cutibacterium")
df <- data.frame(Genus = names(x), prevalence = x) %>% arrange(prevalence)
sorted.names <- df$Genus
df$Genus <- factor(df$Genus, levels = sorted.names)
bs$new <- factor(bs$new, levels=sorted.names)
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(temp.phy, "Genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
x <- prevalence(b.core)
bs <- melt(abundances(b.core))
bs$new <- bs$Var1
#bs$new <- gsub(bs$new, pattern = "Propionibacterium", replacement = "Cutibacterium")
#names(x) <- gsub(names(x), pattern = "Propionibacterium", replacement = "Cutibacterium")
df <- data.frame(Genus = names(x), prevalence = x) %>% arrange(prevalence)
sorted.names <- df$Genus
df$Genus <- factor(df$Genus, levels = sorted.names)
bs$new <- factor(bs$new, levels=sorted.names)
p4 <- ggplot(df, aes(x = Genus, y = prevalence)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_continuous(label = scales::percent) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Most prevalent genera")
print(p4)
bs
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(temp.phy, "Genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
x <- prevalence(b.core)
bs <- melt(abundances(b.core))
bs$new <- bs$Var1
#bs$new <- gsub(bs$new, pattern = "Propionibacterium", replacement = "Cutibacterium")
#names(x) <- gsub(names(x), pattern = "Propionibacterium", replacement = "Cutibacterium")
df <- data.frame(Genus = names(x), prevalence = x) %>% arrange(prevalence)
sorted.names <- df$Genus
df$Genus <- factor(df$Genus, levels = sorted.names)
bs$new <- factor(bs$new, levels=sorted.names)
p4 <- ggplot(bs, aes(x = new, y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_continuous(label = scales::percent) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Most prevalent genera")
print(p4)
x
a <- aggregate_taxa(temp.phy, level = "Genus")
xc <- abundances(transform(a, "compositional"))
df <- melt(xc)
names(df) <- c("Genus", "sample", "value")
dfm <- df %>% group_by(Genus) %>%
summarise(mean = round(100 * mean(value), 1),
#median = round(100 * median(value), 1),
#min = round(100 * min(value), 1),
#max = round(100 * max(value), 1),
prevalence = round(100 * prevalence(value), 1),
sd= round(sd(value),2))%>%
arrange(desc(mean))
kable(dfm)
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(temp.phy, "Genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
x <- prevalence(b.core)
bs <- melt(abundances(b.core))
bs$new <- bs$Var1
#bs$new <- gsub(bs$new, pattern = "Propionibacterium", replacement = "Cutibacterium")
#names(x) <- gsub(names(x), pattern = "Propionibacterium", replacement = "Cutibacterium")
df <- data.frame(Genus = names(x), prevalence = x) %>% arrange(prevalence)
sorted.names <- df$Genus
df$Genus <- factor(df$Genus, levels = sorted.names)
bs$new <- factor(bs$new, levels=sorted.names)
p4 <- ggplot(bs, aes(x = new, y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_continuous(label = scales::percent) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Most prevalent genera")
print(p4)
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(temp.phy, "Genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
x <- prevalence(b.core)
bs <- melt(abundances(b.core))
bs$new <- bs$Var1
#bs$new <- gsub(bs$new, pattern = "Propionibacterium", replacement = "Cutibacterium")
#names(x) <- gsub(names(x), pattern = "Propionibacterium", replacement = "Cutibacterium")
df <- data.frame(Genus = names(x), prevalence = x) %>% arrange(prevalence)
sorted.names <- df$Genus
df$Genus <- factor(df$Genus, levels = sorted.names)
bs$new <- factor(bs$new, levels=sorted.names)
p4 <- ggplot(bs, aes(x = new, y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_continuous(label = scales::percent) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Most prevalent genera")
print(p4)
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(temp.phy, "Genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
x <- prevalence(b.core)
bs <- melt(abundances(b.core))
bs$new <- bs$Var1
#bs$new <- gsub(bs$new, pattern = "Propionibacterium", replacement = "Cutibacterium")
#names(x) <- gsub(names(x), pattern = "Propionibacterium", replacement = "Cutibacterium")
df <- data.frame(Genus = names(x), prevalence = x) %>% arrange(prevalence)
sorted.names <- df$Genus
df$Genus <- factor(df$Genus, levels = sorted.names)
bs$new <- factor(bs$new, levels=sorted.names)
p4 <- ggplot(bs, aes(x = new, y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_continuous(label = scales::percent) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Most prevalent genera")
print(p4)
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(temp.phy, "Genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
x <- prevalence(b.core)
bs <- melt(abundances(b.core))
bs$new <- bs$Var1
#bs$new <- gsub(bs$new, pattern = "Propionibacterium", replacement = "Cutibacterium")
#names(x) <- gsub(names(x), pattern = "Propionibacterium", replacement = "Cutibacterium")
df <- data.frame(Genus = names(x), prevalence = x) %>% arrange(prevalence)
sorted.names <- df$Genus
df$Genus <- factor(df$Genus, levels = sorted.names)
bs$new <- factor(bs$new, levels=sorted.names)
p4 <- ggplot(bs, aes(x = new, y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_continuous(label = scales::percent) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Most prevalent genera")
print(p4)
library(knitr)
a <- aggregate_taxa(temp.phy, level = "Genus")
xc <- abundances(transform(a, "compositional"))
df <- melt(xc)
names(df) <- c("Genus", "sample", "value")
dfm <- df %>% group_by(Genus) %>%
summarise(mean = round(100 * mean(value), 1),
#median = round(100 * median(value), 1),
#min = round(100 * min(value), 1),
#max = round(100 * max(value), 1),
prevalence = round(100 * prevalence(value), 1),
sd= round(sd(value),2))%>%
arrange(desc(mean))
kable(dfm)
#write.csv(dfm, file="genus table.csv")
library(data.table)
a <- data.table:::print.data.table(dfm, nrows = 5, topn=5)
library(knitr)
a <- aggregate_taxa(temp.phy, level = "Genus")
xc <- abundances(transform(a, "compositional"))
df <- melt(xc)
names(df) <- c("Genus", "sample", "value")
dfm <- df %>% group_by(Genus) %>%
summarise(mean = round(100 * mean(value), 1),
#median = round(100 * median(value), 1),
#min = round(100 * min(value), 1),
#max = round(100 * max(value), 1),
prevalence = round(100 * prevalence(value), 1),
sd= round(sd(value),2))%>%
arrange(desc(mean))
kable(dfm)
#write.csv(dfm, file="genus table.csv")
library(data.table)
a <- data.table:::print.data.table(dfm, nrows = 10, topn=5)
theme_set(theme_bw(base_size = 13))
dfm <- melt(abundances(ps.core))
dfm$Var1 <- factor(dfm$Var1, levels = rev(d$Taxon))
dfm$Var_new = str_wrap(dfm$Var1, width = 40)
p2 <- ggplot(dfm, aes(x = Var_new, y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance variation")
print(p2)
transform <- microbiome::transform
j <- transform(temp.phy, "compositional")
sp <- aggregate_taxa(j, "Genus")
o <- aggregate_rare(sp, level = 'Genus',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
phyla.ordering <- names(sort(rowMeans(abundances(transform(o, "compositional")))))
df <- psmelt(o)
#df$Phylum <- factor(df$phylum, levels=phyla.ordering)
sorted.samples.by.Staphylococcus <- unlist(subset(df, Genus=="Staphylococcus") %>% arrange(Abundance) %>% select(Sample))
df$Sample <- factor(df$Sample, levels = sorted.samples.by.Staphylococcus)
#w <- df %>% filter (Family=="A")
#f <- ggplot(w, aes(x = Sample, fill = Genus, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "Relative abundance (%)", x = "Individuals") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phylum", palette = "Set3") + facet_grid(Family ~ .) + facet_grid(cols = vars(Family)) + theme(axis.text.x = element_blank(),legend.position = "none")
#print(f)
pl <- ggplot(df, aes(x=Family, fill= Genus, y= Abundance))+ geom_bar(stat = "identity", colour = "black") + labs(y =  "Relative abundance (%)", x = "Family") + scale_y_continuous(label=scales::percent)
print(pl)
rmarkdown::render("taxonomyprofile.Rmd", output_format = "md_document")
knitr::opts_chunk$set(echo = TRUE)
hc <- hclust(vegan::vegdist(t(abundances(temp.phy)), method="bray"), method="ward.D2")
plot(hc)
plot(hc)
rmarkdown::render("Alphadiversity.Rmd", output_format = "md_document")
