library(gridExtra)
opts_chunk$set(dev="CairoPNG")
knitr::opts_chunk$set(fig.path="output/figure_pcoa/")
method <- "PCoA"
trans <- "compositional"
distance <- "bray"
phy <- readRDS("inputdata/processed/phyloseq/physeq.RDS")
theme_set(theme_bw(30))
p1 <- plot_landscape(microbiome::transform(phy, "compositional"),
distance = distance,
method = method,
size = 5,
col = "Diet",
shading = FALSE)+
scale_colour_brewer(palette = "Set1")	+ labs(title = "Diet") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))
p2 <- plot_landscape(microbiome::transform(phy, "compositional"),
distance = distance,
method = method,
size = 5,
col = "Age",
shading = FALSE)+
scale_colour_brewer(palette = "Set1")	+ labs(title = "Age") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))
p3 <- plot_landscape(microbiome::transform(phy, "compositional"),
distance = distance,
method = method,
size = 5,
col = "Gender",
shading = FALSE)+
scale_colour_brewer(palette = "Set1")	+ labs(title = "Gender") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))
p4 <- plot_landscape(microbiome::transform(phy, "compositional"),
distance = distance,
method = method,
size = 5,
col = "Location",
shading = FALSE)+
scale_colour_brewer(palette = "Set1")	+ labs(title = "Location") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))
p5 <- plot_landscape(microbiome::transform(phy, "compositional"),
distance = distance,
method = method,
size = 5,
col = "Family",
shading = FALSE)+
scale_colour_brewer(palette = "Set1")	+ labs(title = "Family") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))
gridExtra::grid.arrange(p1, p2, p3, p4, p5, nrow = 2)
theme_set(theme_bw(30))
p1 <- plot_landscape(microbiome::transform(phy, "compositional"),
distance = distance,
method = method,
size = 5,
col = "Diet",
shading = FALSE)+
scale_colour_brewer(palette = "Set1")	+ labs(title = "Diet") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))
p2 <- plot_landscape(microbiome::transform(phy, "compositional"),
distance = distance,
method = method,
size = 5,
col = "Age",
shading = FALSE)+
scale_colour_brewer(palette = "Set1")	+ labs(title = "Age") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))
p3 <- plot_landscape(microbiome::transform(phy, "compositional"),
distance = distance,
method = method,
size = 5,
col = "Gender",
shading = FALSE)+
scale_colour_brewer(palette = "Set1")	+ labs(title = "Gender") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))
p4 <- plot_landscape(microbiome::transform(phy, "compositional"),
distance = distance,
method = method,
size = 5,
col = "Location",
shading = FALSE)+
scale_colour_brewer(palette = "Set1")	+ labs(title = "Location") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))
p5 <- plot_landscape(microbiome::transform(phy, "compositional"),
distance = distance,
method = method,
size = 5,
col = "Family",
shading = FALSE)+
scale_colour_brewer(palette = "Set1")	+ labs(title = "Family") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))
gridExtra::grid.arrange(p1, p2, p3, p4, p5, nrow = 2)
theme_set(theme_bw(30))
p1 <- plot_landscape(microbiome::transform(phy, "compositional"),
distance = distance,
method = method,
size = 5,
col = "Diet",
shading = FALSE)+
scale_colour_brewer(palette = "Set1")	+ labs(title = "Diet") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))
p2 <- plot_landscape(microbiome::transform(phy, "compositional"),
distance = distance,
method = method,
size = 5,
col = "Age",
shading = FALSE)+
scale_colour_brewer(palette = "Set1")	+ labs(title = "Age") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))
p3 <- plot_landscape(microbiome::transform(phy, "compositional"),
distance = distance,
method = method,
size = 5,
col = "Gender",
shading = FALSE)+
scale_colour_brewer(palette = "Set1")	+ labs(title = "Gender") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))
p4 <- plot_landscape(microbiome::transform(phy, "compositional"),
distance = distance,
method = method,
size = 5,
col = "Location",
shading = FALSE)+
scale_colour_brewer(palette = "Set1")	+ labs(title = "Location") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))
p5 <- plot_landscape(microbiome::transform(phy, "compositional"),
distance = distance,
method = method,
size = 5,
col = "Family",
shading = FALSE)+
scale_colour_brewer(palette = "Set1")	+ labs(title = "Family") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))
gridExtra::grid.arrange(p1, p2, p3, p4, p5, nrow = 2)
gridExtra::grid.arrange(p1, p2, p3, p4, p5, nrow = 2)
theme_set(theme_bw(30))
p1 <- plot_landscape(microbiome::transform(phy, "compositional"),
distance = distance,
method = method,
size = 5,
col = "Diet",
shading = FALSE)+
scale_colour_brewer(palette = "Set1")	+ labs(title = "Diet") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))
p2 <- plot_landscape(microbiome::transform(phy, "compositional"),
distance = distance,
method = method,
size = 5,
col = "Age",
shading = FALSE)+
scale_colour_brewer(palette = "Set1")	+ labs(title = "Age") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))
p3 <- plot_landscape(microbiome::transform(phy, "compositional"),
distance = distance,
method = method,
size = 5,
col = "Gender",
shading = FALSE)+
scale_colour_brewer(palette = "Set1")	+ labs(title = "Gender") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))
p4 <- plot_landscape(microbiome::transform(phy, "compositional"),
distance = distance,
method = method,
size = 5,
col = "Location",
shading = FALSE)+
scale_colour_brewer(palette = "Set1")	+ labs(title = "Location") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))
p5 <- plot_landscape(microbiome::transform(phy, "compositional"),
distance = distance,
method = method,
size = 5,
col = "Family",
shading = FALSE)+
scale_colour_brewer(palette = "Set1")	+ labs(title = "Family") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))
gridExtra::grid.arrange(p1, p2, p3, p4, p5, nrow = 2)
library(microbiome)
library(phyloseq)
library(vegan)
library(knitr)
library(knitcitations)
library(microbiome)
library(ggplot2)
library(dplyr)
library(reshape2)
#library(DESeq2)
library(Cairo)
library(gridExtra)
method <- "PCoA"
trans <- "compositional"
distance <- "bray"
phy <- readRDS("inputdata/processed/phyloseq/physeq.RDS")
theme_set(theme_bw(30))
p1 <- plot_landscape(microbiome::transform(phy, "compositional"),
distance = distance,
method = method,
size = 5,
col = "Diet",
shading = FALSE)+
scale_colour_brewer(palette = "Set1")	+ labs(title = "Diet") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))
p2 <- plot_landscape(microbiome::transform(phy, "compositional"),
distance = distance,
method = method,
size = 5,
col = "Age",
shading = FALSE)+
scale_colour_brewer(palette = "Set1")	+ labs(title = "Age") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))
p3 <- plot_landscape(microbiome::transform(phy, "compositional"),
distance = distance,
method = method,
size = 5,
col = "Gender",
shading = FALSE)+
scale_colour_brewer(palette = "Set1")	+ labs(title = "Gender") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))
p4 <- plot_landscape(microbiome::transform(phy, "compositional"),
distance = distance,
method = method,
size = 5,
col = "Location",
shading = FALSE)+
scale_colour_brewer(palette = "Set1")	+ labs(title = "Location") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))
p5 <- plot_landscape(microbiome::transform(phy, "compositional"),
distance = distance,
method = method,
size = 5,
col = "Family",
shading = FALSE)+
scale_colour_brewer(palette = "Set1")	+ labs(title = "Family") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))
gridExtra::grid.arrange(p1, p2, p3, p4, p5, nrow = 2)
method <- "PCoA"
trans <- "compositional"
distance <- "bray"
phy <- readRDS("inputdata/processed/phyloseq/physeq.RDS")
#PERMANOVA analysis for Diet
per <- adonis(t(otu_table(phy)) ~ Diet,
data = meta(phy),
permutations=99,
method = distance)
print(per)
#PERMANOVA analysis for Age
pe <- adonis(t(otu_table(phy)) ~ Age,
data = meta(phy),
permutations=99,
method = distance)
print(pe)
#PERMANOVA analysis for gender
perm <- adonis(t(otu_table(phy)) ~ Gender,
data = meta(phy),
permutations=99,
method = distance)
print(perm)
#PERMANOVA analysis for Geographical location
perma <- adonis(t(otu_table(phy)) ~ Location,
data = meta(phy),
permutations=99,
method = distance)
print(perma)
perman <- adonis(t(otu_table(phy)) ~ Family,
data = meta(phy),
permutations=99,
method = distance)
print(perman)
library(microbiome)
library(phyloseq)
library(vegan)
library(knitr)
library(knitcitations)
library(microbiome)
library(ggplot2)
library(dplyr)
library(reshape2)
#library(DESeq2)
library(Cairo)
library(gridExtra)
phy <- readRDS("inputdata/processed/phyloseq/physeq.RDS")
library(microbiome)
library(phyloseq)
library(vegan)
library(knitr)
library(knitcitations)
library(microbiome)
library(ggplot2)
library(dplyr)
library(reshape2)
library(Cairo)
library(gridExtra)
phy <- readRDS("inputdata/processed/phyloseq/physeq.RDS")
knitr::opts_chunk$set(echo = TRUE)
hc <- hclust(vegan::vegdist(t(abundances(phy)), method="bray"), method="ward.D2")
plot(hc)
rmarkdown::render('HierarchialClustering.Rmd','md_document')
rmarkdown::render('Betadiversity.Rmd','md_document')
library("phyloseq")
library("ggplot2")
library("cluster")
library("igraph")
library("markovchain")
library("RColorBrewer")
library(microbiome)
library("gridExtra")
library(tidyr)
library(dplyr)
set.seed(455423)
options(stringsAsFactors = FALSE)
theme_set(theme_bw())
# Init / Read data
# Was created with: source("create_phyloseq.R")
ps <- readRDS("inputdata/processed/phyloseq/physeq.RDS")
tt <- data.frame(tax_table(ps))
ps <- transform(ps, "compositional")
braydist <- phyloseq::distance(ps, method="bray")
ord <- ordinate(ps, method = "MDS", distance = braydist)
plot_scree(ord) + xlim(as.character(seq(1,15))) + ggtitle("MDS-bray ordination eigenvalues")
evs <- ord$value$Eigenvalues
print(evs[1:20])
print(tail(evs))
h_sub5 <- hist(evs[6:length(evs)], 100)
plot(h_sub5$mids, h_sub5$count, log="y", type='h', lwd=10, lend=2)
NDIM <- which(cumsum(evs^2/sum(evs^2)) > 0.9) - 1 # Pick components so that we reach 90% information
x <- ord$vectors[,1:NDIM]  # rows=sample, cols=MDS axes, entries = value
pamPCoA = function(x, k) {
list(cluster = pam(x[,1:2], k, cluster.only = TRUE))
}
gs <- clusGap(x, FUN = pamPCoA, K.max = 12, B = 50)
library("phyloseq")
library("ggplot2")
library("cluster")
library("igraph")
library("markovchain")
library("RColorBrewer")
library(microbiome)
library("gridExtra")
library(tidyr)
library(dplyr)
set.seed(455423)
options(stringsAsFactors = FALSE)
theme_set(theme_bw())
# Init / Read data
# Was created with: source("create_phyloseq.R")
ps <- readRDS("inputdata/processed/phyloseq/physeq.RDS")
tt <- data.frame(tax_table(ps))
ps <- transform(ps, "compositional")
braydist <- phyloseq::distance(ps, method="bray")
ord <- ordinate(ps, method = "MDS", distance = braydist)
plot_scree(ord) + xlim(as.character(seq(1,15))) + ggtitle("MDS-bray ordination eigenvalues")
evs <- ord$value$Eigenvalues
print(evs[1:20])
print(tail(evs))
h_sub5 <- hist(evs[6:length(evs)], 100)
plot(h_sub5$mids, h_sub5$count, log="y", type='h', lwd=10, lend=2)
NDIM <- which(cumsum(evs^2/sum(evs^2)) > 0.9) - 1 # Pick components so that we reach 90% information
x <- ord$vectors[,1:NDIM]  # rows=sample, cols=MDS axes, entries = value
pamPCoA = function(x, k) {
list(cluster = pam(x[,1:2], k, cluster.only = TRUE))
}
gs <- clusGap(x, FUN = pamPCoA, K.max = 12, B = 50)
# Init / Read data
# Was created with: source("create_phyloseq.R")
ps <- readRDS("inputdata/processed/phyloseq/phyloseq.RDS")
tt <- data.frame(tax_table(ps))
ps <- transform(ps, "compositional")
braydist <- phyloseq::distance(ps, method="bray")
ord <- ordinate(ps, method = "MDS", distance = braydist)
plot_scree(ord) + xlim(as.character(seq(1,15))) + ggtitle("MDS-bray ordination eigenvalues")
evs <- ord$value$Eigenvalues
print(evs[1:20])
print(tail(evs))
h_sub5 <- hist(evs[6:length(evs)], 100)
plot(h_sub5$mids, h_sub5$count, log="y", type='h', lwd=10, lend=2)
NDIM <- which(cumsum(evs^2/sum(evs^2)) > 0.9) - 1 # Pick components so that we reach 90% information
x <- ord$vectors[,1:NDIM]  # rows=sample, cols=MDS axes, entries = value
pamPCoA = function(x, k) {
list(cluster = pam(x[,1:2], k, cluster.only = TRUE))
}
gs <- clusGap(x, FUN = pamPCoA, K.max = 12, B = 50)
K <- 3
x <- ord$vectors[,1:NDIM]
clust <- as.factor(pam(x, k=K, cluster.only=T))
sample_data(ps)$CST <- clust
CSTs <- as.character(seq(K))
fisher.test(table(sample_data(ps)[, c("CST", "Location")]))
# Length 6 for consistency with pre-revision CST+ coloration
CSTColors <- brewer.pal(6,"Paired")[c(1,3,2,5,4,6)]
names(CSTColors) <- CSTs
#CSTColorScale <- scale_colour_discrete(name = "CST", values = CSTColors[1:K])
#CSTFillScale <- scale_fill_discrete(name = "CST", values = CSTColors[1:K])
ok <- ordinate(ps, method="NMDS", distance=braydist)
plot_ordination(ps, ok, color="CST") + ggtitle("NMDS -- bray -- CST")
plot_ordination(ps, ok, color="Geographical_location") + ggtitle("NMDS -- bray -- Location")
theme_set(theme_bw(base_size=33))
method <- "PCoA"
trans <- "compositional"
distance <- "bray"
p3 <- microbiome::transform(ps, "compositional")
ordi <- ordinate(p3, method="PCoA", distance="bray")
p4 <- plot_ordination(p3, ordi, color="Geographical_location")+ geom_point(size=5) + theme(legend.position = 'bottom', legend.text=element_text(size=30)) + theme(legend.title=element_blank()) + theme(axis.text.x = element_text(size=30), axis.text.y = element_text(size = 30)) + theme(axis.title = element_text(size = 33)) + labs(x = "PC1 [28.4%]", y= " PC2 [17.7%]", title= "C. Geographical location")
#print(p4)
p8 <- microbiome::transform(ps, "compositional")
ordi <- ordinate(p8, method="PCoA", distance="bray")
p9 <- plot_ordination(p8, ordi, color="CST")+ geom_point(size=5) + theme(legend.position = 'bottom', legend.text=element_text(size=35)) + theme(legend.title=element_blank()) + theme(axis.text.x = element_text(size=30), axis.text.y = element_text(size = 30)) + theme(axis.title = element_text(size = 33)) + labs(x = "PC1 [28.4%]", y= " PC2 [17.7%]", title = "D. CST")
gridExtra::grid.arrange(p4, p9, nrow = 1)
K <- 2
x <- ord$vectors[,1:NDIM]
clust <- as.factor(pam(x, k=K, cluster.only=T))
sample_data(ps)$CST <- clust
CSTs <- as.character(seq(K))
fisher.test(table(sample_data(ps)[, c("CST", "Location")]))
# Length 6 for consistency with pre-revision CST+ coloration
CSTColors <- brewer.pal(6,"Paired")[c(1,3,2,5,4,6)]
names(CSTColors) <- CSTs
#CSTColorScale <- scale_colour_discrete(name = "CST", values = CSTColors[1:K])
#CSTFillScale <- scale_fill_discrete(name = "CST", values = CSTColors[1:K])
ok <- ordinate(ps, method="NMDS", distance=braydist)
plot_ordination(ps, ok, color="CST") + ggtitle("NMDS -- bray -- CST")
plot_ordination(ps, ok, color="Geographical_location") + ggtitle("NMDS -- bray -- Location")
theme_set(theme_bw(base_size=33))
method <- "PCoA"
trans <- "compositional"
distance <- "bray"
p3 <- microbiome::transform(ps, "compositional")
ordi <- ordinate(p3, method="PCoA", distance="bray")
p4 <- plot_ordination(p3, ordi, color="Geographical_location")+ geom_point(size=5) + theme(legend.position = 'bottom', legend.text=element_text(size=30)) + theme(legend.title=element_blank()) + theme(axis.text.x = element_text(size=30), axis.text.y = element_text(size = 30)) + theme(axis.title = element_text(size = 33)) + labs(x = "PC1 [28.4%]", y= " PC2 [17.7%]", title= "C. Geographical location")
#print(p4)
p8 <- microbiome::transform(ps, "compositional")
ordi <- ordinate(p8, method="PCoA", distance="bray")
p9 <- plot_ordination(p8, ordi, color="CST")+ geom_point(size=5) + theme(legend.position = 'bottom', legend.text=element_text(size=35)) + theme(legend.title=element_blank()) + theme(axis.text.x = element_text(size=30), axis.text.y = element_text(size = 30)) + theme(axis.title = element_text(size = 33)) + labs(x = "PC1 [28.4%]", y= " PC2 [17.7%]", title = "D. CST")
gridExtra::grid.arrange(p4, p9, nrow = 1)
theme_set(theme_bw(base_size=33))
method <- "PCoA"
trans <- "compositional"
distance <- "bray"
p3 <- microbiome::transform(ps, "compositional")
ordi <- ordinate(p3, method="PCoA", distance="bray")
p4 <- plot_ordination(p3, ordi, color="location")+ geom_point(size=5) + theme(legend.position = 'bottom', legend.text=element_text(size=30)) + theme(legend.title=element_blank()) + theme(axis.text.x = element_text(size=30), axis.text.y = element_text(size = 30)) + theme(axis.title = element_text(size = 33)) + labs(x = " ", y= " ", title= "C. Geographical location")
#print(p4)
p8 <- microbiome::transform(ps, "compositional")
ordi <- ordinate(p8, method="PCoA", distance="bray")
p9 <- plot_ordination(p8, ordi, color="CST")+ geom_point(size=5) + theme(legend.position = 'bottom', legend.text=element_text(size=35)) + theme(legend.title=element_blank()) + theme(axis.text.x = element_text(size=30), axis.text.y = element_text(size = 30)) + theme(axis.title = element_text(size = 33)) + labs(x = "", y= "", title = "D. CST")
gridExtra::grid.arrange(p4, p9, nrow = 1)
theme_set(theme_bw(base_size=33))
method <- "PCoA"
trans <- "compositional"
distance <- "bray"
p3 <- microbiome::transform(ps, "compositional")
ordi <- ordinate(p3, method="PCoA", distance="bray")
p4 <- plot_ordination(p3, ordi, color="Location")+ geom_point(size=5) + theme(legend.position = 'bottom', legend.text=element_text(size=30)) + theme(legend.title=element_blank()) + theme(axis.text.x = element_text(size=30), axis.text.y = element_text(size = 30)) + theme(axis.title = element_text(size = 33)) + labs(x = " ", y= " ", title= "C. Geographical location")
#print(p4)
p8 <- microbiome::transform(ps, "compositional")
ordi <- ordinate(p8, method="PCoA", distance="bray")
p9 <- plot_ordination(p8, ordi, color="CST")+ geom_point(size=5) + theme(legend.position = 'bottom', legend.text=element_text(size=35)) + theme(legend.title=element_blank()) + theme(axis.text.x = element_text(size=30), axis.text.y = element_text(size = 30)) + theme(axis.title = element_text(size = 33)) + labs(x = "", y= "", title = "D. CST")
gridExtra::grid.arrange(p4, p9, nrow = 1)
theme_set(theme_bw(base_size=33))
method <- "PCoA"
trans <- "compositional"
distance <- "bray"
p3 <- microbiome::transform(ps, "compositional")
ordi <- ordinate(p3, method="PCoA", distance="bray")
p4 <- plot_ordination(p3, ordi, color="Location")+ geom_point(size=5) + theme(legend.position = 'bottom', legend.text=element_text(size=30)) + theme(legend.title=element_blank()) + theme(axis.text.x = element_text(size=30), axis.text.y = element_text(size = 30)) + theme(axis.title = element_text(size = 33)) + labs(x = " ", y= " ", title= "Geographical location")
#print(p4)
p8 <- microbiome::transform(ps, "compositional")
ordi <- ordinate(p8, method="PCoA", distance="bray")
p9 <- plot_ordination(p8, ordi, color="CST")+ geom_point(size=5) + theme(legend.position = 'bottom', legend.text=element_text(size=35)) + theme(legend.title=element_blank()) + theme(axis.text.x = element_text(size=30), axis.text.y = element_text(size = 30)) + theme(axis.title = element_text(size = 33)) + labs(x = "", y= "", title = "CST")
gridExtra::grid.arrange(p4, p9, nrow = 1)
theme_set(theme_bw(base_size = 23))
library(BBmisc)
library(reshape2)
library("RColorBrewer")
library(tidyr)
set.seed(1234)
# Identify ASVs that are most different between CSTs
pvs <- c()
for (tax in taxa(ps)) {
pvs[[tax]] <- kruskal.test(abundances(ps)[tax,] ~ meta(ps)$CST)$p.value
}
pvs <- sort(unlist(pvs))
significant.taxa <- names(pvs)[which(as.numeric(p.adjust(pvs)) < 0.25)]
# Pick full names for the taxa
full.names <- apply(tax_table(ps), 1, function (x) {paste(x, collapse = "_")})
pso<- prune_taxa(significant.taxa, ps)
pso1<- microbiome::transform(pso, 'clr')
g<- otu_table(pso1)
g1<-BBmisc::normalize(g@.Data, 'standardize', range = c(0,1))
colnames(g1)<- colnames(otu_table(pso1)@.Data)
j<- otu_table(g1, taxa_are_rows = T)
otu_table(pso1)<- j
p <- list()
sort.taxa <- neatsort(pso1, "rows")
dfm <- tab <- data.frame(ASV = significant.taxa, Full_name = full.names[significant.taxa])
dfm$short_name <- dfm$Full_name %>% strsplit("_" ) %>% sapply(tail, 1 )
#tab$short_names <- tab$Full_name %>% strsplit("_" ) %>% sapply(tail, 1 )
for(CST in CSTs) {
pshm <- prune_samples(sample_data(pso1)$CST == CST, pso1)
dfm <- melt(abundances(pshm))
dfm$short_name <- full.names[as.character(dfm$Var1)] %>% strsplit("_" ) %>% sapply(tail, 1 )
p[[CST]]<- heat((dfm), "Var2","short_name", "value", legend.text = "Abundance", order.rows = F,
order.cols = F, limits= c(-5,5), step = 2) +
ggtitle(paste("CST:", CST)) + theme(axis.text.x = element_blank()) +labs(x= "Individuals")
print(p[[CST]])
}
rmarkdown::render("Betadiversity.Rmd","md_document")
theme_set(theme_bw(base_size=33))
method <- "PCoA"
trans <- "compositional"
distance <- "bray"
p3 <- microbiome::transform(ps, "compositional")
ordi <- ordinate(p3, method="PCoA", distance="bray")
ordi
p4 <- plot_ordination(p3, ordi, color="Location")
p4
#print(p4)
p8 <- microbiome::transform(ps, "compositional")
ordi <- ordinate(p8, method="PCoA", distance="bray")
p9 <- plot_ordination(p8, ordi, color="CST")
p9
theme_set(theme_bw(base_size=33))
method <- "PCoA"
trans <- "compositional"
distance <- "bray"
p3 <- microbiome::transform(ps, "compositional")
ordi <- ordinate(p3, method="PCoA", distance="bray")
p4 <- plot_ordination(p3, ordi, color="Location")+ geom_point(size=5) + theme(legend.position = 'bottom', legend.text=element_text(size=30)) + theme(legend.title=element_blank()) + theme(axis.text.x = element_text(size=30), axis.text.y = element_text(size = 30)) + theme(axis.title = element_text(size = 33)) + labs(x = "Axis1 [44.6%]", y= "Axis2 [22.4%]", title= "Geographical location")
#print(p4)
p8 <- microbiome::transform(ps, "compositional")
ordi <- ordinate(p8, method="PCoA", distance="bray")
p9 <- plot_ordination(p8, ordi, color="CST")+ geom_point(size=5) + theme(legend.position = 'bottom', legend.text=element_text(size=35)) + theme(legend.title=element_blank()) + theme(axis.text.x = element_text(size=30), axis.text.y = element_text(size = 30)) + theme(axis.title = element_text(size = 33)) + labs(x = "Axis1 [44.6%]", y= "Axis2 [22.4%]", title = "CST")
gridExtra::grid.arrange(p4, p9, nrow = 1)
NDIM <- which(cumsum(evs^2/sum(evs^2)) > 0.9) - 1 # Pick components so that we reach 90% information
x <- ord$vectors[,1:NDIM]  # rows=sample, cols=MDS axes, entries = value
pamPCoA = function(x, k) {
list(cluster = pam(x[,1:2], k, cluster.only = TRUE))
}
gs <- clusGap(x, FUN = pamPCoA, K.max = 12, B = 50)
