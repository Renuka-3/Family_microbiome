---
title: "Betadiversity"
author: "Renuka"
date: "02/02/2022"
output: html_document
---

# PCoA analysis 

```{r pcoa, echo=FALSE, message=FALSE, warning=FALSE}
library(microbiome)
library(phyloseq)
library(vegan)
library(knitr)
library(knitcitations)
library(microbiome)
library(ggplot2)
library(dplyr)
library(reshape2)
#library(DESeq2)
library(Cairo)
library(gridExtra)

method <- "PCoA"
trans <- "compositional"
distance <- "bray"
physeqnew <- readRDS("inputdata/processed/phyloseq/physeqnew.RDS")
temp.phy <- filter_taxa(physeqnew, function (x) {sum(x > 0) > 1}, prune=TRUE)
```

## *Principal Coordinates Analysis (PCoA)*

* Ordination method: `r method`
* Dissimilarity measure: `r distance`

```{r PCoA, echo=FALSE, message=FALSE, fig.width=25, fig.height=20, fig.show="hold", warning=FALSE}
theme_set(theme_bw(30))

p1 <- plot_landscape(microbiome::transform(temp.phy, "compositional"),
                    distance = distance,
                    method = method,
                    size = 5,
                    col = "Diet",
                    shading = FALSE)+
  scale_colour_brewer(palette = "Set1")	+ labs(title = "Diet") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))


p2 <- plot_landscape(microbiome::transform(temp.phy, "compositional"),
                    distance = distance,
                    method = method,
                    size = 5,
                    col = "Age",
                    shading = FALSE)+
  scale_colour_brewer(palette = "Set1")	+ labs(title = "Age") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))

p3 <- plot_landscape(microbiome::transform(temp.phy, "compositional"),
                    distance = distance,
                    method = method,
                    size = 5,
                    col = "Gender",
                    shading = FALSE)+
  scale_colour_brewer(palette = "Set1")	+ labs(title = "Gender") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))

p4 <- plot_landscape(microbiome::transform(temp.phy, "compositional"),
                    distance = distance,
                    method = method,
                    size = 5,
                    col = "Location",
                    shading = FALSE)+
  scale_colour_brewer(palette = "Set1")	+ labs(title = "Location") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))

p5 <- plot_landscape(microbiome::transform(temp.phy, "compositional"),
                    distance = distance,
                    method = method,
                    size = 5,
                    col = "Family",
                    shading = FALSE)+
  scale_colour_brewer(palette = "Set1")	+ labs(title = "Family") + theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))
         
gridExtra::grid.arrange(p1, p2, p3, p4, p5, nrow = 2)
```


# PERMANOVA analysis

```{r PERMANOVA, warning=FALSE, echo=FALSE, massage=FALSE}
method <- "PCoA"
trans <- "compositional"
distance <- "bray"
p_adj_method <- "BH"
alpha <- 0.05
#phy <- readRDS("inputdata/processed/phyloseq/physeq.RDS")

# PERMANOVA analysis for all co-factors

trans <- "compositional"
distance <- "bray"
p_adj_method <- "BH"
alpha <- 0.05
results <- list()
p <- adonis(t(otu_table(temp.phy)) ~ Diet + Age + Gender + Location + Family,
         data = meta(temp.phy),
	 permutations=199,
	 method = distance)
p$aov.tab
```

# Conclusion- 
Here we found that geographical location and families are significantly associated with bacterial community composition.
No significant difference were observed in Age, Gender and Diet group.
