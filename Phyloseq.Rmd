---
title: "phyloseq"
output: html_document
---

```{r phyloseq, message=FALSE, warning=FALSE, error=FALSE}
library(ggplot2)
library(phyloseq)
library(dada2)
library(readxl)
library(dplyr)

otu_mat<- read_excel("inputdata/processed/tables_new/OTU_table.xlsx")
tax_mat<- read_excel("inputdata/processed/tables_new/Taxa_table.xlsx")
samples_df <- read_excel("inputdata/processed/tables_new/Metadata.xlsx")

row.names(otu_mat) <- otu_mat$OTUU
otu_mat <- otu_mat %>% select (-OTUU)
row.names(tax_mat) <- tax_mat$OTUU
tax_mat <- tax_mat %>% select (-OTUU) 
row.names(samples_df) <- samples_df$Sample

otu_mat <- as.matrix(otu_mat)
tax_mat <- as.matrix(tax_mat)

OTU = otu_table(otu_mat, taxa_are_rows = TRUE)
TAX = tax_table(tax_mat)
sam = sample_data(as.data.frame(samples_df))

phyloseqnew <- phyloseq(OTU, TAX, sam)
saveRDS(phyloseq, file = "inputdata/processed/phyloseq/phyloseqnew.RDS")

library(ape)
random_tree = rtree(ntaxa(phyloseqnew), rooted=TRUE, tip.label=taxa_names(phyloseqnew))
ape::write.tree(random_tree, file='famtree.nwk')
plot(random_tree)
#new worked# famtree <- ape::read.tree("famtree.nwk")
#trying to built tree# tse <- TreeSummarizedExperiment(assays = list(counts = counts_trimmed),
                                colData = samples,
                                rowData = tax,
                                rowTree = tree)

physeqnew = merge_phyloseq(phyloseqnew, random_tree)
physeqnew
saveRDS(physeqnew, file = "inputdata/processed/phyloseq/physeqnew.RDS")

temp <- filter_taxa(physeqnew, function (x) {sum(x > 0) > 1}, prune=TRUE)
```

